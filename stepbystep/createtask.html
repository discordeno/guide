<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating Tasks | Discordeno</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="Docs for Discordeno">
    <meta name="theme-color" content="#7289DA">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="og:title" content="Discordeno">
    <meta name="og:description" content="Docs for Discordeno">
    <meta name="og:type" content="website">
    <meta name="og:url" content="https://discordeno.mod.land">
    <meta name="og:image" content="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.1ace810b.css" as="style"><link rel="preload" href="/assets/js/app.a995d4f4.js" as="script"><link rel="preload" href="/assets/js/2.92552348.js" as="script"><link rel="preload" href="/assets/js/31.46ece116.js" as="script"><link rel="prefetch" href="/assets/js/10.9c068ad3.js"><link rel="prefetch" href="/assets/js/11.71a65321.js"><link rel="prefetch" href="/assets/js/12.8d5abe65.js"><link rel="prefetch" href="/assets/js/13.cc80950c.js"><link rel="prefetch" href="/assets/js/14.cdfa1e0a.js"><link rel="prefetch" href="/assets/js/15.26e5d5fb.js"><link rel="prefetch" href="/assets/js/16.584a1d3b.js"><link rel="prefetch" href="/assets/js/17.0e6a7823.js"><link rel="prefetch" href="/assets/js/18.ea90f6fa.js"><link rel="prefetch" href="/assets/js/19.4fd13301.js"><link rel="prefetch" href="/assets/js/20.efe9afa2.js"><link rel="prefetch" href="/assets/js/21.67406029.js"><link rel="prefetch" href="/assets/js/22.e143dd98.js"><link rel="prefetch" href="/assets/js/23.5f44fd1a.js"><link rel="prefetch" href="/assets/js/24.90b984c4.js"><link rel="prefetch" href="/assets/js/25.820e8434.js"><link rel="prefetch" href="/assets/js/26.9634f9f8.js"><link rel="prefetch" href="/assets/js/27.5abde80d.js"><link rel="prefetch" href="/assets/js/28.7b500ac6.js"><link rel="prefetch" href="/assets/js/29.72514780.js"><link rel="prefetch" href="/assets/js/3.83ec0db1.js"><link rel="prefetch" href="/assets/js/30.18e8c76d.js"><link rel="prefetch" href="/assets/js/32.12fbd1c1.js"><link rel="prefetch" href="/assets/js/4.467b809f.js"><link rel="prefetch" href="/assets/js/5.21a988cb.js"><link rel="prefetch" href="/assets/js/6.1102e6bd.js"><link rel="prefetch" href="/assets/js/7.ea2f4aba.js"><link rel="prefetch" href="/assets/js/8.ea604a9c.js"><link rel="prefetch" href="/assets/js/9.4be16aab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1ace810b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Discordeno</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://doc.deno.land/https/deno.land/x/discordeno/mod.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/5vBgXk3UcZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/discordeno/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://doc.deno.land/https/deno.land/x/discordeno/mod.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/5vBgXk3UcZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/discordeno/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Big Bots Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Step By Step Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/stepbystep/" aria-current="page" class="sidebar-link">Step By Step Guide</a></li><li><a href="/stepbystep/createbot.html" class="sidebar-link">Creating The Bot!</a></li><li><a href="/stepbystep/createcommand.html" class="sidebar-link">Creating A Command</a></li><li><a href="/stepbystep/createevent.html" class="sidebar-link">Creating Events!</a></li><li><a href="/stepbystep/createlanguage.html" class="sidebar-link">Creating Languages!</a></li><li><a href="/stepbystep/createmonitor.html" class="sidebar-link">Creating Monitors!</a></li><li><a href="/stepbystep/createinhibitor.html" class="sidebar-link">Creating Inhibitors!</a></li><li><a href="/stepbystep/createtask.html" aria-current="page" class="active sidebar-link">Creating Tasks</a></li><li><a href="/stepbystep/hostingbot.html" class="sidebar-link">Hosting Your Bot Online 24/7!</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced Guide</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="creating-tasks"><a href="#creating-tasks" class="header-anchor">#</a> Creating Tasks</h1> <p>Phenomenal! Now that you have mastered monitors, let's move on to one of the
final parts, Tasks. A lot of times, you will want to do something over and over
again. To do this, you can use tasks. You could technically just do this with
<code>setInterval</code> but, with tasks you gain a little more advantage like having
reloadability. The functions that are run can be easily reloaded meaning, you
don't need to restart your whole bot just for little change.</p> <h2 id="what-is-a-task"><a href="#what-is-a-task" class="header-anchor">#</a> What is a Task?</h2> <p>A task is used to conduct a function every so often. For example, Discordeno
comes with a built in task called <code>botlists</code>. This task runs every so often and
updates your data in all the bot lists apis. Let's create a new task to really
understand the gist of it. Let's create a task that will run every 5 minutes
which will keep our cache clean and minimal allowing your bot to grow and scale
much larger without needing a much bigger server to host it on. Start by pasting
the following snippet below:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> botCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Milliseconds <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/constants/time.ts&quot;</span><span class="token punctuation">;</span>

botCache<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">taskname</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">taskname</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  interval<span class="token operator">:</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">HOUR</span><span class="token punctuation">,</span>
  <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This is where you put your code you want to run.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="understanding-the-options"><a href="#understanding-the-options" class="header-anchor">#</a> Understanding The Options</h2> <ul><li><code>name</code>: The name property is just the name of the task. Useful for logs and
such to tell you which task is running.</li> <li><code>interval</code>: The amount of millisconds to wait before executing this function
again.</li> <li><code>execute</code>: The function to execute.</li></ul> <h2 id="what-is-cache-and-why-should-we-sweep-it"><a href="#what-is-cache-and-why-should-we-sweep-it" class="header-anchor">#</a> What is Cache and Why Should We Sweep It?</h2> <p>Your bot's cache is the memory it is holding on to since it started. To
understand this slightly easier we have an example: when you buy a server to
host your bot on you can check how much RAM (memory) it has. That amount of
memory can be expensive $$$ so it is best to build a bot that does not use a ton
of memory. You can use this task to tell your bot to delete any memory it is
holding on to that is not necessary.</p> <ul><li>Suppose we don't want to keep any presence cached.</li> <li>Remove any members from cache that have not been active in the last 30
minutes.</li> <li>Removes any messages sent over 10 minutes ago.</li></ul> <h2 id="adding-pseudo-code"><a href="#adding-pseudo-code" class="header-anchor">#</a> Adding Pseudo Code</h2> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> botCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Milliseconds <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/constants/time.ts&quot;</span><span class="token punctuation">;</span>

botCache<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">taskname</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">taskname</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  interval<span class="token operator">:</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">HOUR</span><span class="token punctuation">,</span>
  <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// For every server, we will clean the cache</span>

    <span class="token comment">// Delete presences from the bots cache and server caches.</span>

    <span class="token comment">// Delete any member who has not been active in the last 30 minutes and is not currently in a voice channel</span>

    <span class="token comment">// Delete any messages over 10 minutes old</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="adding-the-code"><a href="#adding-the-code" class="header-anchor">#</a> Adding The Code</h2> <p>Now that we have a plan in place, let's add the code.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> botCache<span class="token punctuation">,</span> cache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Milliseconds <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/constants/time.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">MESSAGE_LIFETIME</span> <span class="token operator">=</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MEMBER_LIFETIME</span> <span class="token operator">=</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">;</span>

botCache<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sweeper</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sweeper</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  interval<span class="token operator">:</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Delete presences from the bots cache.</span>
    cache<span class="token punctuation">.</span>presences<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For every server, we will clean the cache</span>
    cache<span class="token punctuation">.</span>guilds<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>guild<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Delete presences from the server caches.</span>
      guild<span class="token punctuation">.</span>presences<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Delete any member who has not been active in the last 30 minutes and is not currently in a voice channel</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For ever, message we will delete if necessary</span>
    cache<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Delete any messages over 10 minutes old</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> message<span class="token punctuation">.</span>timestamp <span class="token operator">&gt;</span> <span class="token constant">MESSAGE_LIFETIME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alrighty, we managed to add most of the code. But we hit a small obstacle. There
is no way to tell when the last time a member was active was. In order to
accomplish this we will need to add this functionality. No problem, let's get
cracking.</p> <h2 id="adding-member-activity-tracker"><a href="#adding-member-activity-tracker" class="header-anchor">#</a> Adding Member Activity Tracker</h2> <p>Let's go to the botCache in <code>cache.ts</code> file and add a <code>new Collection</code> that will
hold the member's id + server id as the key since a member can be in multiple
servers. The value for the map will be a timestamp showing when they were last
active. We will be able to use this check, how long ago they were last active.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>memberLastActive<span class="token operator">:</span>
<span class="token keyword">new</span> <span class="token class-name">Collection<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now, let's go to our <code>messageCreate</code>, event and add 1 line to update this value.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>botCache<span class="token punctuation">.</span>memberLastActive<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">,</span> message<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will store the time when the message was sent by the member using their id.</p> <h2 id="cleaning-out-inactive-members"><a href="#cleaning-out-inactive-members" class="header-anchor">#</a> Cleaning Out Inactive Members</h2> <p>Now, we can get back to cleaning out the members from the cache. The final code
should look something like this:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> botCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../mod.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Milliseconds <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../utils/constants/time.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../deps.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">MESSAGE_LIFETIME</span> <span class="token operator">=</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MEMBER_LIFETIME</span> <span class="token operator">=</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">;</span>

botCache<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sweeper</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sweeper</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  interval<span class="token operator">:</span> Milliseconds<span class="token punctuation">.</span><span class="token constant">MINUTE</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Delete presences from the bots cache.</span>
    cache<span class="token punctuation">.</span>presences<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For every guild, we will clean the cache</span>
    cache<span class="token punctuation">.</span>guilds<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>guild<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Delete presences from the guild caches.</span>
      guild<span class="token punctuation">.</span>presences<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Delete any member who has not been active in the last 30 minutes and is not currently in a voice channel</span>
      guild<span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>member<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// The user is currently active in a voice channel</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>guild<span class="token punctuation">.</span>voiceStates<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> lastActive <span class="token operator">=</span> botCache<span class="token punctuation">.</span>memberLastActive<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// If the user is active recently</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastActive <span class="token operator">&amp;&amp;</span> now <span class="token operator">-</span> lastActive <span class="token operator">&lt;</span> <span class="token constant">MEMBER_LIFETIME</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

        guild<span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        botCache<span class="token punctuation">.</span>memberLastActive<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For ever, message we will delete if necessary</span>
    cache<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Delete any messages over 10 minutes old</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> message<span class="token punctuation">.</span>timestamp <span class="token operator">&gt;</span> <span class="token constant">MESSAGE_LIFETIME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you reload/restart your bot now, you will begin to see massive improvements
in cache/RAM usage. Feel free to take some time and customize this to your needs
for your bot. For example, in this case, I opted to keep voice states but if
your bot does not do anything voice related, you can save even more memory by
deleting voice states.</p> <hr> <p>Remember, optimizing cache is a very difficult thing to do so don't worry if it
doesnt make too much sense. The main thing to take away from this guide is how
to create a function that runs every X amount of time. When your bot grows
enough where it reaches a point where you need to worry about optimzing the
cache, join the Discord server and we can chat.</p> <p>Cheers 🎉</p> <p>Thank you for reading this step by step guide to creating a Discord bot. There
are many more powerful things in Discordeno, but they take a little more
advanced skills to master. Once you have gone through all this, feel free to
jump into the advanced section of the guide to become an advanced level Discord
Bot Developer!</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/discordeno/guide/edit/main/src/stepbystep/createtask.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/1/2022, 2:17:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/stepbystep/createinhibitor.html" class="prev">
        Creating Inhibitors!
      </a></span> <span class="next"><a href="/stepbystep/hostingbot.html">
        Hosting Your Bot Online 24/7!
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a995d4f4.js" defer></script><script src="/assets/js/2.92552348.js" defer></script><script src="/assets/js/31.46ece116.js" defer></script>
  </body>
</html>
