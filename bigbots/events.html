<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Step 4: Creating Standalone Event Handler | Discordeno</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="Docs for Discordeno">
    <meta name="theme-color" content="#7289DA">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="og:title" content="Discordeno">
    <meta name="og:description" content="Docs for Discordeno">
    <meta name="og:type" content="website">
    <meta name="og:url" content="https://discordeno.mod.land">
    <meta name="og:image" content="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.1ace810b.css" as="style"><link rel="preload" href="/assets/js/app.2fbe72c7.js" as="script"><link rel="preload" href="/assets/js/2.92552348.js" as="script"><link rel="preload" href="/assets/js/18.ea90f6fa.js" as="script"><link rel="prefetch" href="/assets/js/10.9c068ad3.js"><link rel="prefetch" href="/assets/js/11.71a65321.js"><link rel="prefetch" href="/assets/js/12.8d5abe65.js"><link rel="prefetch" href="/assets/js/13.cc80950c.js"><link rel="prefetch" href="/assets/js/14.cdfa1e0a.js"><link rel="prefetch" href="/assets/js/15.26e5d5fb.js"><link rel="prefetch" href="/assets/js/16.584a1d3b.js"><link rel="prefetch" href="/assets/js/17.0e6a7823.js"><link rel="prefetch" href="/assets/js/19.4fd13301.js"><link rel="prefetch" href="/assets/js/20.efe9afa2.js"><link rel="prefetch" href="/assets/js/21.67406029.js"><link rel="prefetch" href="/assets/js/22.e143dd98.js"><link rel="prefetch" href="/assets/js/23.5f44fd1a.js"><link rel="prefetch" href="/assets/js/24.90b984c4.js"><link rel="prefetch" href="/assets/js/25.820e8434.js"><link rel="prefetch" href="/assets/js/26.9634f9f8.js"><link rel="prefetch" href="/assets/js/27.5abde80d.js"><link rel="prefetch" href="/assets/js/28.7b500ac6.js"><link rel="prefetch" href="/assets/js/29.72514780.js"><link rel="prefetch" href="/assets/js/3.83ec0db1.js"><link rel="prefetch" href="/assets/js/30.18e8c76d.js"><link rel="prefetch" href="/assets/js/31.46ece116.js"><link rel="prefetch" href="/assets/js/32.12fbd1c1.js"><link rel="prefetch" href="/assets/js/4.467b809f.js"><link rel="prefetch" href="/assets/js/5.21a988cb.js"><link rel="prefetch" href="/assets/js/6.1102e6bd.js"><link rel="prefetch" href="/assets/js/7.ea2f4aba.js"><link rel="prefetch" href="/assets/js/8.ea604a9c.js"><link rel="prefetch" href="/assets/js/9.4be16aab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1ace810b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Discordeno</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <!----> <!----></div></div></div> <!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://doc.deno.land/https/deno.land/x/discordeno/mod.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/5vBgXk3UcZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/discordeno/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://doc.deno.land/https/deno.land/x/discordeno/mod.ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://discord.gg/5vBgXk3UcZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/discordeno/guide" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Big Bots Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigbots/" aria-current="page" class="sidebar-link">Step By Step Guide</a></li><li><a href="/bigbots/rest.html" class="sidebar-link">Step 1: Creating A Standalone REST Process</a></li><li><a href="/bigbots/gateway.html" class="sidebar-link">Step 2: Creating A Standalone Gateway Process</a></li><li><a href="/bigbots/cache.html" class="sidebar-link">Step 3: Standalone Cache Process</a></li><li><a href="/bigbots/events.html" aria-current="page" class="active sidebar-link">Step 4: Creating Standalone Event Handler</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Step By Step Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Advanced Guide</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="step-4-creating-standalone-event-handler"><a href="#step-4-creating-standalone-event-handler" class="header-anchor">#</a> Step 4: Creating Standalone Event Handler</h1> <p>Now we are about to start working on the bot code itself. The last 3 steps should be completed by the time you reach this. The event handler process will be listening for events from any number of gateway instances and be ready to handle them.</p> <p>In this guide, we may use the term <code>Bot</code> or the term <code>event handler</code>, remember that these refer to the same thing. This is your main bot code.</p> <h2 id="why-use-standalone-event-handler-process"><a href="#why-use-standalone-event-handler-process" class="header-anchor">#</a> Why Use Standalone Event Handler Process?</h2> <p>The standalone event handler is the portion of your bot code that you will be changing the most. The three previous steps created processes that are intended to never be turned off. This process is designed to let you restart whenever you wish and be incredibly quick to restart. Since we don't have the delay to start up shards anymore, your code becomes reloaded instantly.</p> <h2 id="creating-event-handlers"><a href="#creating-event-handlers" class="header-anchor">#</a> Creating Event Handlers</h2> <p>Create a file path like <code>src/bot/mod.ts</code>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DISCORD_TOKEN</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../configs.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createBot<span class="token punctuation">,</span> Collection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> psql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./cache/mod.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token function">createBot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  token<span class="token operator">:</span> <span class="token constant">DISCORD_TOKEN</span><span class="token punctuation">,</span>
  botId<span class="token operator">:</span> <span class="token number">270010330782892032n</span><span class="token punctuation">,</span>
  <span class="token comment">// applicationId: 270010330782892032,</span>
  intents<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Guilds&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GuildMessages&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">messageCreate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message arrived&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  cache<span class="token operator">:</span> <span class="token punctuation">{</span>
    isAsync<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">customTableCreator</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tables <span class="token operator">=</span> <span class="token punctuation">{</span>
        users<span class="token operator">:</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
        channels<span class="token operator">:</span> <span class="token string">&quot;channels&quot;</span><span class="token punctuation">,</span>
        guilds<span class="token operator">:</span> <span class="token string">&quot;guilds&quot;</span><span class="token punctuation">,</span>
        messages<span class="token operator">:</span> <span class="token string">&quot;messages&quot;</span><span class="token punctuation">,</span>
        presences<span class="token operator">:</span> <span class="token string">&quot;presences&quot;</span><span class="token punctuation">,</span>
        threads<span class="token operator">:</span> <span class="token string">&quot;threads&quot;</span><span class="token punctuation">,</span>
        unavailableGuilds<span class="token operator">:</span> <span class="token string">&quot;unavailableGuilds&quot;</span><span class="token punctuation">,</span>
        members<span class="token operator">:</span> <span class="token string">&quot;members&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;I HACKED ITOH!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">/** Get a single item from the table */</span>
        <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>
            tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span>
          <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> WHERE &quot;id&quot; = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>psql<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/** Completely empty this table. */</span>
        <span class="token keyword">async</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">TRUNCATE TABLE </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/** Delete the data related to this key from table. */</span>
        <span class="token keyword">async</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DELETE FROM </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>
            tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span>
          <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> WHERE &quot;id&quot; = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>psql<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/** Check if there is data assigned to this key. */</span>
        <span class="token keyword">async</span> <span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>
            <span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT 1 FROM </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>
              tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> WHERE &quot;id&quot; = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>psql<span class="token punctuation">.</span>types<span class="token punctuation">.</span><span class="token function">bigint</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/** Check how many items are stored in this table. */</span>
        <span class="token keyword">async</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT COUNT(&quot;id&quot;) FROM </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/** Store new data to this table. */</span>
        <span class="token keyword">async</span> <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> psql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">psql</span><span class="token punctuation">(</span>
            data<span class="token punctuation">,</span>
            <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// THESE TWO ARE USELESS FOR CUSTOM CACHE BUT NEED TO SHUT UP TS ERRORS</span>
        <span class="token keyword">async</span> <span class="token function">forEach</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">async</span> <span class="token function">filter</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alright that was a lot of code. Now let's break it down little by little.</p> <h3 id="understanding-createbot"><a href="#understanding-createbot" class="header-anchor">#</a> Understanding createBot()</h3> <p><strong>Basic Keys</strong></p> <ul><li><code>token</code> if you can't figure this out stop reading and find another guide please. Thanks.</li> <li><code>botId</code> This is going to be your bot id. The reason we require this here is because we are going to set up a standalone gateway process. With most other libs, they can fill this information using the READY event. However, since our gateway is designed not to reboot, we are not going to get the READY event whenever we restart our bot. This means we won't be able to fill this information later. Another method to get the id is to use the <code>token</code> but discord developers have mentioned that this behavior is not documented and not supposed to be relied on to remain stable. Due to these reasons, we chose to just require the bot id be passed here.</li> <li><code>applicationId</code> is an optional choice if your bot is old and has a unique id different from it's bot id.</li> <li><code>intents</code>: Provide the intents you like using strings or a number. String form supports autocomplete and type safety.</li> <li><code>events</code>: These are your event handler functions. When a MESSAGE_CREATE event arrives from Discord it will be processed here. We will set up the routing to run these functions later in the guide but for now you can see how to set it up. Note, you can create these functions in separate files and just import them here as you wish.</li> <li><code>cache</code>: This is going to be the cache part. We will discuss this more below.</li></ul> <h3 id="understanding-cache-option"><a href="#understanding-cache-option" class="header-anchor">#</a> Understanding Cache Option</h3> <p>Since we are using a standalone gateway a custom cache is essentially required as explained in step 3 of this guide. Please remember, to mark the cache as <code>async</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code>cache<span class="token operator">:</span> <span class="token punctuation">{</span>
    isAsync<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you opt into the async cache, you must also provide a table creator function. This will not actually create any tables but it will create an object with methods to manage your &quot;tables&quot;. Man we need a better name for this. Please send recommendations to @Skillz4Killz in discord. Thanks. Until then, please blame wolf for the terrible name. 😃</p> <p>Alrighty, now let's dig deeper into this function.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> tables <span class="token operator">=</span> <span class="token punctuation">{</span>
  users<span class="token operator">:</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span>
  channels<span class="token operator">:</span> <span class="token string">&quot;channels&quot;</span><span class="token punctuation">,</span>
  guilds<span class="token operator">:</span> <span class="token string">&quot;guilds&quot;</span><span class="token punctuation">,</span>
  messages<span class="token operator">:</span> <span class="token string">&quot;messages&quot;</span><span class="token punctuation">,</span>
  presences<span class="token operator">:</span> <span class="token string">&quot;presences&quot;</span><span class="token punctuation">,</span>
  threads<span class="token operator">:</span> <span class="token string">&quot;threads&quot;</span><span class="token punctuation">,</span>
  unavailableGuilds<span class="token operator">:</span> <span class="token string">&quot;unavailableGuilds&quot;</span><span class="token punctuation">,</span>
  members<span class="token operator">:</span> <span class="token string">&quot;members&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tables<span class="token punctuation">[</span>table<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;I HACKED ITOH!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This part of the code is only going to make sense if you are used to PGSQL. To prevent any attacks here we will forcibly control which table will be used.</p> <p>This function must return an object with several methods on it. You can see the methods above.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/** Get a single item from the table */</span>
<span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// WHATEVER CODE YOU WOULD LIKE TO USE HERE</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can insert any code you desire for your cache system here. Since we were using PGSQL, we used sql queries to make these requests. However, should you need to communicate to Redis or anything else of your choice, you can do so here.</p> <blockquote><p>Note: The .filter() and .forEach() methods are unnecessary and should not be used for your bot as they are not optimized for performance. These are made for smaller bot users who would not leave itoh alone and in order to please them itoh gave them their hearts desire! LMAO!</p></blockquote> <h2 id="customizing-internal-code"><a href="#customizing-internal-code" class="header-anchor">#</a> Customizing Internal Code</h2> <p>One of the best parts about discordeno is the flexibility. In order to show this off, we will use the <code>user</code> example but you can apply this to any part of the library.</p> <h3 id="why-is-customizing-important"><a href="#why-is-customizing-important" class="header-anchor">#</a> Why Is Customizing Important?</h3> <p>At large scale, every single property can become expensive to store in your cache. For example, if your bot does not make use of a <code>channel.topic</code> why storing potentially millions of strings in your memory for something you never need/user. This could save you potentially GBs of memory to just remove this one property.</p> <h3 id="customizing-process"><a href="#customizing-process" class="header-anchor">#</a> Customizing Process</h3> <p>First, let's create a file in some path like <code>src/bot/internals/mod.ts</code>. Note that we will create quite a few files below simply to keep code cleaner and simpler, in expectation that it will grow more complex later. You can merge them as you wish.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> customizeBotTransformers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./transformers/mod.ts&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">customizeBotInternals</span><span class="token punctuation">(</span>bot<span class="token operator">:</span> Bot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bot <span class="token operator">=</span> <span class="token function">customizeBotTransformers</span><span class="token punctuation">(</span>bot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ADD AS MANY MORE CUSTOMIZATIONS HERE AS YOU LIKE TO HANDLERS, HELPERS, UTILS ETC...</span>
    <span class="token keyword">return</span> bot<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We also need to add another file now at <code>src/bot/internals/transformers/mod.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../../deps.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> customizeUserTransformer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.ts'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">customizeBotTransformers</span><span class="token punctuation">(</span>bot<span class="token operator">:</span> Bot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bot <span class="token operator">=</span> <span class="token function">customizeUserTransformer</span><span class="token punctuation">(</span>bot<span class="token punctuation">)</span>
  <span class="token comment">// ADD ANY MORE CUSTOM TRANSFORMERS HERE</span>
  <span class="token keyword">return</span> bot
<span class="token punctuation">}</span>
</code></pre></div><p>One more file at <code>src/bot/internals/transformers/user.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Bot<span class="token punctuation">,</span> DiscordenoUser<span class="token punctuation">,</span> transformUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../deps.ts'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">customizeUserTransformer</span><span class="token punctuation">(</span>bot<span class="token operator">:</span> Bot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  bot<span class="token punctuation">.</span>transformers<span class="token punctuation">.</span><span class="token function-variable function">user</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>bot<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// REMOVE USELESS PROPS OUR BOT DOESNT USE</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> system<span class="token punctuation">,</span> locale<span class="token punctuation">,</span> verified<span class="token punctuation">,</span> email<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> mfaEnabled<span class="token punctuation">,</span> premiumType<span class="token punctuation">,</span> publicFlags<span class="token punctuation">,</span> <span class="token operator">...</span>user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">transformUser</span><span class="token punctuation">(</span>
      bot<span class="token punctuation">,</span>
      payload<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// RETURN ONLY USEFUL PROPS WE NEED TO USE AND CACHE IF NECESSARY</span>
    <span class="token keyword">return</span> user <span class="token keyword">as</span> DiscordenoUser
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> bot<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>First we override the internal transformer for the <code>user</code> object. What's cool is the typings will be automatically provided 😃 Next, we use the <code>transformUser</code> function from the lib itself to make it create the internal user version. The reason I do this is so when I update the library and a new property is added or removed i can simply update and get it. Should you desire maximum control you can remove this entirely and only have what you want no matter what discord sends. Discordeno gives you the ability to stay in control.</p> <p>This method can be applied to any transformer, helper function, gateway event handler, util function or any part of the library. Anything and everything is possible to override. You do NOT need to fork and modify the library ever and give yourself a headache trying to maintain your fork with updates.</p> <h2 id="handling-incoming-gateway-events"><a href="#handling-incoming-gateway-events" class="header-anchor">#</a> Handling Incoming Gateway Events</h2> <p>Remember, this is a separate process we need to make sure we are listening to incoming events from our gateway instances. Since we used http in our Gateway step, we can create an http listener here as well.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/discordeno/guide/edit/main/src/bigbots/events.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/1/2022, 3:08:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bigbots/cache.html" class="prev">
        Step 3: Standalone Cache Process
      </a></span> <span class="next"><a href="/stepbystep/">
        Step By Step Guide
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.2fbe72c7.js" defer></script><script src="/assets/js/2.92552348.js" defer></script><script src="/assets/js/18.ea90f6fa.js" defer></script>
  </body>
</html>
