"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6842],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return p}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=d(t),p=r,h=m["".concat(s,".").concat(p)]||m[p]||u[p]||i;return t?a.createElement(h,o(o({ref:n},c),{},{components:t})):a.createElement(h,o({ref:n},c))}));function p(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=t[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2102:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return c},default:function(){return m}});var a=t(7462),r=t(3366),i=(t(7294),t(3905)),o=["components"],l={sidebar_position:6},s="Design",d={unversionedId:"nodejs/design",id:"nodejs/design",title:"Design",description:"In order to ensure long-term scalability and maintainability, the code structure is of enormous importance. In the",source:"@site/docs/nodejs/design.md",sourceDirName:"nodejs",slug:"/nodejs/design",permalink:"/docs/nodejs/design",editUrl:"https://github.com/discordeno/discordeno/tree/main/site/docs/nodejs/design.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Create Components",permalink:"/docs/nodejs/Structures/components"},next:{title:"Getting Started with the Event Handler",permalink:"/docs/nodejs/EventHandler/getting-started"}},c=[{value:"Code Structure",id:"code-structure",children:[],level:2},{value:"CommandHandler &amp; BaseCommand",id:"commandhandler--basecommand",children:[{value:"Steps showed in the following Guide",id:"steps-showed-in-the-following-guide",children:[],level:3}],level:2},{value:"EventHandler",id:"eventhandler",children:[],level:2},{value:"Structures",id:"structures",children:[],level:2},{value:"Plugins",id:"plugins",children:[],level:2},{value:"Error Handling",id:"error-handling",children:[],level:2},{value:"Caching",id:"caching",children:[],level:2},{value:"Cross Communication &amp; Scaling",id:"cross-communication--scaling",children:[],level:2}],u={toc:c};function m(e){var n=e.components,t=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"design"},"Design"),(0,i.kt)("p",null,"In order to ensure long-term scalability and maintainability, the code structure is of enormous importance. In the\nfollowing, we show how such a code structure could look like."),(0,i.kt)("p",null,"The essential parts are a ",(0,i.kt)("inlineCode",{parentName:"p"},"CommandHandler/CommandManager"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"EventHandler/EventManager"),", lots of ",(0,i.kt)("inlineCode",{parentName:"p"},"Structures")," in order to\ncode faster and ",(0,i.kt)("inlineCode",{parentName:"p"},"Plugins"),", where your different features will be, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"Commands"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"DB Stuff"),"..."),(0,i.kt)("h2",{id:"code-structure"},"Code Structure"),(0,i.kt)("p",null,"We recommend following structure for your code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-root"},"\u251cindex.js\n\u251c\u2500Structures/\n\u251c\u2500Managers/\n\u251c\u2500events/\n\u251c\u2500Plugins/\n\u251c\u2500\u2500 General/\n\u2502   \u251c\u2500\u2500 commands/\n\u2502   \u2502   \u251c\u2500\u2500 ping.js\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 Developer/\n\u2502   \u251c\u2500\u2500 commands/\n\u2502   \u2502   \u251c\u2500\u2500 eval.js\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u251c\u2500Util/\n\u2514\u2500\u2500 ...\n")),(0,i.kt)("p",null,"The following explains why this structure is suitable. If you want to follow this guide further, you should create these\nfolders."),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"Managers")," folder the Managers will be added e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"CommandManager.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"EventManager.js"),". Generally codes, which\nmanage the system."),(0,i.kt)("p",null,"While in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Structures")," folder mainly classes are added like ",(0,i.kt)("inlineCode",{parentName:"p"},"BaseCommand.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"CommandResponse.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Embed.js"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"Components.js"),", which make it easier to add methods to objects."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"events")," folder will contain the event handlers such as ",(0,i.kt)("inlineCode",{parentName:"p"},"messageCreate.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"debug.js")),(0,i.kt)("p",null,"Your many useful features and categories end up in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Plugins")," folder, where they should be categorically divided into\nmany folders."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Util")," folder contains functions or classes that help you convert certain things, such as timestamps, into a\nhuman-readable format."),(0,i.kt)("h2",{id:"commandhandler--basecommand"},"CommandHandler & BaseCommand"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"CommandHandler")," is the main class of the bot, which will handle all the commands and the events received from\nDiscord."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"BaseCommand")," is the base class of all commands, which will be extended with the",(0,i.kt)("inlineCode",{parentName:"p"},"CommandResponse")," class."),(0,i.kt)("h3",{id:"steps-showed-in-the-following-guide"},"Steps showed in the following Guide"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Loading commands from different plugins"),(0,i.kt)("li",{parentName:"ul"},"Deploying slash commands"),(0,i.kt)("li",{parentName:"ul"},"Handling ",(0,i.kt)("inlineCode",{parentName:"li"},"messageCreate")," & ",(0,i.kt)("inlineCode",{parentName:"li"},"interactionCreate")," events"),(0,i.kt)("li",{parentName:"ul"},"Command rate limit handling"),(0,i.kt)("li",{parentName:"ul"},"Handle ",(0,i.kt)("inlineCode",{parentName:"li"},"Interaction")," & ",(0,i.kt)("inlineCode",{parentName:"li"},"Message")," commands with the same code"),(0,i.kt)("li",{parentName:"ul"},"Validating user provided arguments"),(0,i.kt)("li",{parentName:"ul"},"Correct permission and error handling"),(0,i.kt)("li",{parentName:"ul"},"Hot reloading commands"),(0,i.kt)("li",{parentName:"ul"},"Creating message and interaction collectors")),(0,i.kt)("h2",{id:"eventhandler"},"EventHandler"),(0,i.kt)("p",null,"You probably realized that Discordeno does not use an ",(0,i.kt)("inlineCode",{parentName:"p"},"EventEmitter")," to fire the events, but your own event function is\nfired."),(0,i.kt)("p",null,"There are ways to adapt to an ",(0,i.kt)("inlineCode",{parentName:"p"},"EventEmitter"),", but we decided against it for the following reasons:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"It's easy to create memory leaks, when you add too many listeners or go carelessly with it."),(0,i.kt)("li",{parentName:"ul"},"Many fragmented parts of event code complicate maintenance."),(0,i.kt)("li",{parentName:"ul"},"ErrorHandling is difficult and debugging is harder when many listeners are open for the same events.")),(0,i.kt)("h2",{id:"structures"},"Structures"),(0,i.kt)("p",null,"Structures are essential to abstract larger parts of code in smaller ready-made methods and to modify them if necessary."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'class Command {\n  static name = "ping";\n  static aliases = ["pong"];\n  static botPermission = ["SEND_EMBED_LINKS"];\n\n  run(message, args) {\n    // do something\n  }\n}\n')),(0,i.kt)("p",null,"It would be annoying adding everytime the ",(0,i.kt)("inlineCode",{parentName:"p"},"botPermission")," property to the class Command, when the Permission is used\nfrom every Command, then it is unnecessary to add it, when you can extend the class."),(0,i.kt)("p",null,"It would be annoying to add the ",(0,i.kt)("inlineCode",{parentName:"p"},"botPermission")," property to the command class every time the same permissions are used\nby each command. Extending the class makes this extra step obsolete."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'class BaseCommand {\n  constructor(client) {\n    this.client = client;\n    this.basePermission = ["SEND_EMBED_LINKS"];\n  }\n}\n\nclass Command extends BaseCommand {\n  static name = "ping";\n  static aliases = ["pong"];\n\n  constructor(data) {\n    super(data);\n  }\n\n  run(message, args) {\n    // do something\n  }\n}\n')),(0,i.kt)("h2",{id:"plugins"},"Plugins"),(0,i.kt)("p",null,"The plugins folder helps you categorize your code into many parts to give some structure."),(0,i.kt)("p",null,"Of course, this has many advantages, you have a much clearer code, you can debug problems much easier."),(0,i.kt)("p",null,'This also opens possibilities for open source contributions, since not all parts of the code have to be published in\norder to add new plugins, since they are "independent".'),(0,i.kt)("p",null,"There will be the main ",(0,i.kt)("inlineCode",{parentName:"p"},"Plugins")," folder, which by default contains a ",(0,i.kt)("inlineCode",{parentName:"p"},"General")," folder for all your base commands. The\n",(0,i.kt)("inlineCode",{parentName:"p"},"Plugins")," folder will also contain all your other plugins."),(0,i.kt)("h2",{id:"error-handling"},"Error Handling"),(0,i.kt)("p",null,"One of the most important things is how to handle errors. This is done to provide a user-friendly experience and to find\nerrors faster."),(0,i.kt)("p",null,"You should catch errors and log them in your logger so you can fix them later. There are several open source ",(0,i.kt)("inlineCode",{parentName:"p"},"Sentry"),"'s\nthat give you a good overview of the latest errors through a website."),(0,i.kt)("p",null,"Sometimes errors have a positive effect on maintainability and scalability."),(0,i.kt)("p",null,"In addition, handling errors caused by users is very important to increase transparency. If they don't know why the\nerror happened, then they'll be very surprised with what they did wrong and might even remove your bot from their\nserver."),(0,i.kt)("h2",{id:"caching"},"Caching"),(0,i.kt)("p",null,"Normally libraries cache all the info they get, which can of course be helpful at the beginning to discover all\nfunctionalities but later it turns out to be a resource-consuming method. Therefore, this way should be avoided."),(0,i.kt)("p",null,"Discordeno allows ",(0,i.kt)("inlineCode",{parentName:"p"},"Custom Caching")," and even ",(0,i.kt)("inlineCode",{parentName:"p"},"Custom Property Caching")," which gives you fine-grained control over the\ncaching of data. Normally you only need 20% of the data received by Discord, which makes caching unnecessary in most\ncases."),(0,i.kt)("p",null,"There are also some ",(0,i.kt)("inlineCode",{parentName:"p"},"Filter")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Sweeper")," methods which help you to empty unused cache values."),(0,i.kt)("h2",{id:"cross-communication--scaling"},"Cross Communication & Scaling"),(0,i.kt)("p",null,"If you are running many different processes, such as a Welcomer API, communication is of central importance in order to\nsend or receive data, with which you can then perform certain actions."),(0,i.kt)("p",null,"Cross communication can be easily done with sockets or a TCP client."),(0,i.kt)("p",null,"This brings up this Structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"Bridge (Heart)\n- Machine 1\n   - Cluster [0-9]\n- Machine 2\n   - Cluster [10-18]\n- Machine 3 -> Welcomer Api\n- Machine 4 -> Dashboard\n")),(0,i.kt)("p",null,'It\'s important to use something fast to have a proper "real time" communication.'),(0,i.kt)("p",null,"Discordeno already offers many internal options for scaling bots, no matter what size."),(0,i.kt)("p",null,"As you scale, you will likely separate many parts of your bot and put them in separate processes, such as a\n",(0,i.kt)("inlineCode",{parentName:"p"},"RestManager"),", a ",(0,i.kt)("inlineCode",{parentName:"p"},"Gateway Manager")," etc."),(0,i.kt)("p",null,"This of course opens up a lot of possibilities:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Zero downtime updates"),(0,i.kt)("li",{parentName:"ul"},"Global cache"),(0,i.kt)("li",{parentName:"ul"},"Synced rate limits")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/discordeno/discordeno#features"},"Check the Github Readme for more information")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"congratulations")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You just learned how to design a scalable bot, let's get into implementing it with the next pages."))))}m.isMDXComponent=!0}}]);